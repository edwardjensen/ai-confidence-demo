name: Deploy Environment Variables to Cloudflare

on:
  workflow_dispatch: # Manual trigger
  push:
    branches: [main]
    paths: ['.github/workflows/deploy-env-vars.yml'] # Only run when this file changes

jobs:
  deploy-env-vars:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '24.x'

    - name: Install Wrangler
      run: npm install -g wrangler

    - name: Authenticate with Cloudflare
      run: |
        echo "${{ secrets.CLOUDFLARE_API_TOKEN }}" | wrangler auth login --api-token

    - name: Set OpenRouter API Key
      run: |
        wrangler pages secret put OPENROUTER_API_KEY_V2 \
          --project-name=${{ secrets.CLOUDFLARE_PROJECT_NAME }} \
          --env=production <<< "${{ secrets.OPENROUTER_API_KEY_V2 }}"

    - name: Set OpenAI API Key
      run: |
        wrangler pages secret put OPENAI_EMBEDDINGS_API_KEY \
          --project-name=${{ secrets.CLOUDFLARE_PROJECT_NAME }} \
          --env=production <<< "${{ secrets.OPENAI_EMBEDDINGS_API_KEY }}"

    - name: Verify deployment
      run: |
        echo "✅ Environment variables deployed successfully!"
        echo "🔐 API keys are now securely stored in Cloudflare Pages"